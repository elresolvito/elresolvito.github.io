<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>El Resolvito | Tu Tienda a Domicilio en La Habana</title>
    <meta name="description" content="Encuentra víveres, pizzas y más en El Resolvito. Haz tu pedido online y recíbelo en La Habana. Compra fácil y rápido por WhatsApp.">
    <meta name="keywords" content="tienda online habana, mercado habana, entrega a domicilio cuba, mandados habana, pizzas habana, el resolvito">
    <meta name="author" content="El Resolvito">

  <!-- ========================================================= -->
<!-- === BLOQUE DE ÍCONOS Y MANIFEST PROFESIONAL (HÍBRIDO) === -->
<!-- ========================================================= -->

<!-- 1. Instrucción principal para Android y navegadores modernos -->
<link rel="manifest" href="/manifest.json?v=4"> <!-- Incrementamos la versión -->

<!-- 2. Color de la barra del navegador -->
<meta name="theme-color" content="#0d3b33">

<!-- 3. Instrucción de respaldo para Android y principal para iOS -->
<!--    Chrome la usará si el manifest falla. Safari (iPhone) la usará siempre. -->
<!--    Apuntamos al ícono más grande que tenemos para asegurar la calidad. -->
<link rel="apple-touch-icon" href="/android-chrome-512x512.png">

<!-- 4. Favicons estándar para pestañas de navegador, marcadores, etc. -->
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #0d3b33;
            --accent-color: #c94a37;
            --background-white: #ffffff;
            --light-background-gray: #f9fafb;
            --text-dark: #1f2937;
            --text-medium: #4b5563;
            --dark-overlay: rgba(0, 0, 0, 0.6);
        }
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', sans-serif; background-color: var(--light-background-gray); }
        .text-fixed-sm { font-size: 0.75rem; } @media (min-width: 768px) { .text-fixed-sm { font-size: 0.875rem; } }
        .text-fixed-base { font-size: 0.875rem; } @media (min-width: 768px) { .text-fixed-base { font-size: 1rem; } }
        .text-fixed-lg { font-size: 1rem; } @media (min-width: 768px) { .text-fixed-lg { font-size: 1.125rem; } }
        .text-fixed-xl { font-size: 1.125rem; } @media (min-width: 768px) { .text-fixed-xl { font-size: 1.25rem; } }
        .text-fixed-2xl { font-size: 1.25rem; } @media (min-width: 768px) { .text-fixed-2xl { font-size: 1.5rem; } }
        .text-fixed-3xl { font-size: 1.5rem; } @media (min-width: 768px) { .text-fixed-3xl { font-size: 1.875rem; } }
        .text-fixed-4xl { font-size: 1.875rem; } @media (min-width: 768px) { .text-fixed-4xl { font-size: 2.25rem; } }
        .text-fixed-6xl { font-size: 2.5rem; } @media (min-width: 768px) { .text-fixed-6xl { font-size: 3.75rem; } }
        
        /* Ajustes para el slider */
        .hero-slider-container { position: relative; width: 100%; height: 100%; background-color: #000; overflow: hidden; }
        .hero-slide { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-size: cover; background-position: center; opacity: 0; visibility: hidden; transition: opacity 1s ease-in-out; }
        .hero-slide.active { opacity: 1; visibility: visible; }
        .hero-slide .hero-overlay { background-color: var(--dark-overlay); }
        .slider-nav { position: absolute; top: 50%; transform: translateY(-50%); width: 100%; display: flex; justify-content: space-between; padding: 0 1rem; z-index: 20; }
        .slider-nav button { background-color: rgba(255, 255, 255, 0.2); color: white; border: 1px solid white; border-radius: 50%; width: 40px; height: 40px; font-size: 24px; cursor: pointer; transition: background-color 0.3s; }
        .slider-nav button:hover { background-color: rgba(255, 255, 255, 0.4); }
        
        /* CORRECCIÓN: Sombra de texto para mejorar la legibilidad */
        .hero-text-shadow {
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
        }

        .slide-content > * {
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        .hero-slide:not(.active) .slide-content > * {
            opacity: 0;
            transform: translateY(20px);
        }
        .hero-slide.active .slide-content > * {
            opacity: 1;
            transform: translateY(0);
        }
        .hero-slide.active .slide-content > *:nth-child(1) { transition-delay: 0.3s; }
        .hero-slide.active .slide-content > *:nth-child(2) { transition-delay: 0.4s; }
        .hero-slide.active .slide-content > *:nth-child(3) { transition-delay: 0.5s; }


        header.scrolled { background-color: rgba(13, 59, 51, 0.95); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        .modal-overlay { opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; }
        .modal-overlay.show { opacity: 1; visibility: visible; }
        .modal-content { transform: translateY(-20px); opacity: 0; transition: transform 0.3s ease, opacity 0.3s ease; }
        .modal-overlay.show .modal-content { transform: translateY(0); opacity: 1; }
        #mobile-menu { transform: translateX(-100%); transition: transform 0.3s ease-in-out; }
        #mobile-menu.open { transform: translateX(0); }
        #mobile-backdrop { opacity: 0; visibility: hidden; transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out; }
        #mobile-backdrop.open { opacity: 1; visibility: visible; }
        .unit-type-btn.active { background-color: var(--primary-color); color: white; }
        .shake { animation: shake-animation 0.6s ease-in-out; }
        @keyframes shake-animation { 0% { transform: translateX(0); } 15% { transform: translateX(-8px) rotate(-5deg); } 30% { transform: translateX(8px) rotate(5deg); } 45% { transform: translateX(-8px) rotate(-5deg); } 60% { transform: translateX(8px) rotate(5deg); } 75% { transform: translateX(-5px) rotate(-2deg); } 90% { transform: translateX(5px) rotate(2deg); } 100% { transform: translateX(0); } }
        .cash-btn { border: 1px solid #d1d5db; padding: 8px 12px; border-radius: 8px; font-size: 0.875rem; transition: all 0.2s; }
        .cash-btn.active { background-color: var(--primary-color); color: white; border-color: var(--primary-color); }
        .fade-in-up, .fade-in-left, .fade-in-right { opacity: 0; transition: opacity 0.6s ease-out, transform 0.6s ease-out; }
        .fade-in-up { transform: translateY(30px); }
        .fade-in-left { transform: translateX(-30px); }
        .fade-in-right { transform: translateX(30px); }
        .is-visible { opacity: 1; transform: none; }
        .category-btn { background-color: #f3f4f6; color: var(--text-medium); padding: 8px 16px; border-radius: 9999px; font-weight: 600; transition: all 0.2s; border: 1px solid transparent; }
        .category-btn:hover { background-color: #e5e7eb; }
        .category-btn.active { background-color: var(--primary-color); color: white; border-color: var(--primary-color); }
    </style>
</head>
<body class="text-gray-800">

<header id="mainHeader" class="fixed top-0 left-0 right-0 z-50 transition-all duration-300">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between py-2">
        <div class="flex items-center gap-4">
            <button id="mobile-menu-button" class="md:hidden text-white"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg></button>
            <a href="#" class="flex items-center gap-3 flex-shrink-0">
                <img src="https://i.postimg.cc/s2FHrX2Y/logo_el_resolvito.jpg" class="h-12 w-12 md:h-16 md-w-16 rounded-full shadow-md object-cover">
                <span class="text-white text-fixed-lg md:text-xl font-bold hidden sm:block">El Resolvito</span>
            </a>
        </div>
        <nav class="hidden md:flex items-center gap-4 md:gap-6 text-white font-semibold">
            <a href="#mercado" class="text-fixed-lg hover:text-gray-300 transition-colors duration-300">Mercado</a>
            <a href="#pizzas" class="text-fixed-lg hover:text-gray-300 transition-colors duration-300">Pizzas</a>
            <a href="#como-comprar" class="text-fixed-lg hover:text-gray-300 transition-colors duration-300">¿Cómo Comprar?</a>
            <a href="#contacto" class="text-fixed-lg hover:text-gray-300 transition-colors duration-300">Contacto</a>
        </nav>
    </div>
</header>

<div id="mobile-menu" class="fixed top-0 left-0 h-full w-64 bg-[var(--primary-color)] z-50 shadow-xl md:hidden">
    <div class="p-6">
        <div class="flex justify-between items-center mb-8">
            <a href="#" class="flex items-center gap-2">
                <img src="https://i.postimg.cc/s2FHrX2Y/logo_el_resolvito.jpg" alt="El Resolvito Logo" class="h-12 w-12 rounded-full object-cover">
                <span class="text-white text-fixed-lg font-bold">El Resolvito</span>
            </a>
            <button id="close-mobile-menu" class="text-white"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
        </div>
        <nav class="flex flex-col space-y-4 text-fixed-lg font-semibold text-white">
            <a href="#mercado" class="hover:text-gray-300 transition-colors mobile-nav-link">Mercado</a>
            <a href="#pizzas" class="hover:text-gray-300 transition-colors mobile-nav-link">Pizzas</a>
            <a href="#como-comprar" class="hover:text-gray-300 transition-colors mobile-nav-link">¿Cómo Comprar?</a>
            <a href="#contacto" class="hover:text-gray-300 transition-colors mobile-nav-link">Contacto</a>
        </nav>
    </div>
</div>
<div id="mobile-backdrop" class="fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden"></div>

<main>
    <!-- ======================================================= -->
    <!-- === INICIO DEL HERO SLIDER === -->
    <!-- ======================================================= -->
    <section class="relative h-[60vh] md:h-[80vh] min-h-[400px]">
        <div id="heroSlider" class="hero-slider-container">
            <!-- Slide 1: Mercado -->
            <div class="hero-slide" style="background-image: url('https://i.postimg.cc/rsCKV7LZ/1755367982611.jpg');">
                <div class="hero-overlay absolute inset-0"></div>
                <!-- Contenido alineado a la izquierda en pantallas grandes -->
                <div class="container mx-auto px-4 sm:px-6 lg:px-8 relative z-10 h-full flex items-center justify-center lg:justify-start">
                    <div class="slide-content text-center lg:text-left">
                        <h1 class="text-fixed-4xl md:text-fixed-6xl font-extrabold mb-4 hero-text-shadow">EL RESOLVITO</h1>
                        <p class="text-fixed-lg md:text-fixed-xl max-w-lg mx-auto lg:mx-0 mb-8 hero-text-shadow">Mercado y víveres... a un clic de distancia.</p>
                        <a href="#mercado" class="bg-[var(--accent-color)] text-white font-bold py-3 px-8 rounded-full text-fixed-lg hover:bg-opacity-90 transform hover:scale-105 transition-all duration-300 shadow-lg">Explorar Productos</a>
                    </div>
                </div>
            </div>

            <!-- Slide 2: Pizzas -->
            <div class="hero-slide" style="background-image: url('https://i.postimg.cc/Xvb6nzgY/pizza-1.png');">
                <div class="hero-overlay absolute inset-0"></div>
                <!-- Contenido alineado a la derecha en pantallas grandes -->
                <div class="container mx-auto px-4 sm:px-6 lg:px-8 relative z-10 h-full flex items-center justify-center lg:justify-end">
                    <div class="slide-content text-center lg:text-right">
                        <h1 class="text-fixed-4xl md:text-fixed-6xl font-extrabold mb-4 hero-text-shadow">¡NUESTRAS PIZZAS!</h1>
                        <p class="text-fixed-lg md:text-fixed-xl max-w-lg mx-auto lg:mx-0 mb-8 hero-text-shadow">Calientes y deliciosas, directas a tu puerta.</p>
                        <a href="#pizzas" class="bg-[var(--accent-color)] text-white font-bold py-3 px-8 rounded-full text-fixed-lg hover:bg-opacity-90 transform hover:scale-105 transition-all duration-300 shadow-lg">Ver Menú</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Botones de Navegación -->
        <div class="slider-nav hidden md:flex">
            <button id="prevSlideBtn" aria-label="Anterior">&lt;</button>
            <button id="nextSlideBtn" aria-label="Siguiente">&gt;</button>
        </div>
    </section>
    <!-- ======================================================= -->
    <!-- === FIN DEL HERO SLIDER === -->
    <!-- ======================================================= -->

    <section id="mercado" class="py-16 lg:py-24 bg-gray-50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12 fade-in-up">
                <h2 class="text-fixed-3xl md:text-fixed-4xl font-bold text-[var(--text-dark)]">Mercado y Víveres</h2>
                <p class="mt-4 text-fixed-lg text-[var(--text-medium)] max-w-3xl mx-auto">Encuentra productos que necesitas para tu hogar, desde bebidas refrescantes hasta productos frescos.</p>
            </div>
            
            <div class="bg-white border-2 border-dashed border-green-200 p-4 rounded-xl shadow-md mb-8 text-center fade-in-up">
                <h3 class="text-fixed-lg md:text-fixed-xl font-bold text-[var(--primary-color)] mb-3">¡Ahorra en cada pedido en La Habana Vieja!</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm md:text-base">
                    <div class="bg-green-50 p-3 rounded-lg">
                        <p class="font-semibold text-gray-800">Compras de $1,500+</p>
                        <p class="text-green-700 font-bold">Paga solo $50 de envío</p>
                    </div>
                    <div class="bg-green-100 p-3 rounded-lg ring-2 ring-[var(--accent-color)]">
                        <p class="font-semibold text-gray-800">Compras de $3,500+</p>
                        <p class="text-[var(--accent-color)] font-extrabold text-lg">¡ENVÍO GRATIS!</p>
                    </div>
                    <div class="bg-green-50 p-3 rounded-lg">
                        <p class="font-semibold text-gray-800">Tarifa Regular</p>
                        <p class="text-gray-600 font-bold">$150</p>
                    </div>
                </div>
            </div>

            <div class="bg-white p-4 rounded-xl shadow-lg mb-8 fade-in-up" style="transition-delay: 150ms;">
                <input type="text" id="mercadoSearchInput" placeholder="Buscar en Mercado y Víveres..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[var(--primary-color)] focus:border-transparent transition text-fixed-base">
            </div>
            <div id="mercadoCategoryFilters" class="flex flex-wrap justify-center gap-2 mb-8 fade-in-up" style="transition-delay: 300ms;"></div>
            <div id="mercadoProductGrid"></div>
            <p id="mercadoNoResultsMessage" class="hidden text-center text-fixed-lg text-[var(--text-medium)] mt-8">No se encontraron productos que coincidan con tu búsqueda.</p>
        </div>
    </section>

    <!-- ======================================================= -->
    <!-- === NUEVA SECCIÓN PARA PIZZAS (PLACEHOLDER) === -->
    <!-- ======================================================= -->
    <section id="pizzas" class="py-16 lg:py-24 bg-white">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12 fade-in-up">
                <h2 class="text-fixed-3xl md:text-fixed-4xl font-bold text-[var(--text-dark)]">Pizzas</h2>
                <p class="mt-4 text-fixed-lg text-[var(--text-medium)] max-w-3xl mx-auto">Próximamente... Nuestro delicioso menú de pizzas estará disponible aquí.</p>
            </div>
            <!-- Aquí iría el contenedor para los productos de pizza, similar a la sección de mercado -->
            <!-- <div id="pizzaProductGrid"></div> -->
        </div>
    </section>
    
    <section id="como-comprar" class="py-16 lg:py-24 bg-gray-50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12 fade-in-up">
                <h2 class="text-fixed-3xl md:text-fixed-4xl font-bold text-[var(--text-dark)]">¿Cómo Comprar en Línea?</h2>
                <p class="mt-4 text-fixed-lg text-[var(--text-medium)] max-w-3xl mx-auto">Hacer tu pedido es muy fácil. Sigue estos sencillos pasos para recibir tus productos sin complicaciones.</p>
            </div>
            <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-6 text-center">
                <div class="fade-in-left"><div class="text-fixed-4xl mb-4 text-[var(--primary-color)]">1.</div><h3 class="text-fixed-xl font-bold mb-2">Elige Productos</h3><p class="text-fixed-base text-[var(--text-medium)]">Navega por nuestra tienda y añade los artículos que desees a tu carrito de compras.</p></div>
                <div class="flex items-center justify-center text-gray-300 text-fixed-4xl font-light hidden md:flex">→</div>
                <div class="fade-in-right" style="transition-delay: 150ms;"><div class="text-fixed-4xl mb-4 text-[var(--primary-color)]">2.</div><h3 class="text-fixed-xl font-bold mb-2">Revisa tu Carrito</h3><p class="text-fixed-base text-[var(--text-medium)]">Abre tu carrito, revisa tu selección y las cantidades. Cuando estés listo, pulsa "Enviar Pedido".</p></div>
                <div class="flex items-center justify-center text-gray-300 text-fixed-4xl font-light hidden md:flex">→</div>
                <div class="fade-in-left" style="transition-delay: 300ms;"><div class="text-fixed-4xl mb-4 text-[var(--primary-color)]">3.</div><h3 class="text-fixed-xl font-bold mb-2">Completa tus Datos</h3><p class="text-fixed-base text-[var(--text-medium)]">Llena el formulario con tu información de contacto, dirección de entrega, y método de pago preferido.</p></div>
                <div class="flex items-center justify-center text-gray-300 text-fixed-4xl font-light hidden md:flex">→</div>
                <div class="fade-in-right" style="transition-delay: 450ms;"><div class="text-fixed-4xl mb-4 text-[var(--primary-color)]">4.</div><h3 class="text-fixed-xl font-bold mb-2">Confirma y Recibe</h3><p class="text-fixed-base text-[var(--text-medium)]">Confirma tu pedido y te contactaremos por WhatsApp para coordinar la entrega.</p></div>
            </div>
            <div class="mt-12 max-w-4xl mx-auto bg-blue-50 p-6 rounded-xl fade-in-up">
                <h3 class="text-fixed-xl font-bold text-[var(--text-dark)] mb-4 text-center">Nuestra Política de Envíos</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="text-center">
                        <h4 class="font-bold text-[var(--primary-color)] mb-2">Habana Vieja</h4>
                        <ul class="list-none space-y-1 text-fixed-sm text-[var(--text-medium)]">
                            <li>• Tarifa regular: <strong class="text-[var(--text-dark)]">$150 CUP</strong></li>
                            <li>• En compras de $1,500 o más: <strong class="text-green-600">¡Paga solo $50 CUP de envío!</strong></li>
                            <li>• En compras de $3,500 o más: <strong class="text-green-600">¡Tu envío es TOTALMENTE GRATIS!</strong></li>
                        </ul>
                    </div>
                    <div class="text-center">
                        <h4 class="font-bold text-[var(--primary-color)] mb-2">Otros Municipios</h4>
                        <p class="text-fixed-sm text-[var(--text-medium)]">• Costo según agencia de mensajería.</p>
                        <p class="text-fixed-sm text-[var(--text-medium)]">• Te confirmaremos el precio por WhatsApp.</p>
                    </div>
                </div>
                <div class="text-center mt-6 border-t pt-4">
                    <p class="font-bold text-gray-800">Horarios de Reparto:</p>
                    <p class="text-fixed-sm text-[var(--text-medium)]">Pedidos recibidos antes de las 11:00 AM se entregan de 12 PM a 2 PM.</p>
                    <p class="text-fixed-sm text-[var(--text-medium)]">Pedidos recibidos antes de las 4:00 PM se entregan de 5 PM a 7 PM.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="contacto" class="py-16 lg:py-24 bg-white">
         <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12 fade-in-up">
                <h2 class="text-fixed-3xl md:text-fixed-4xl font-bold text-[var(--text-dark)]">Únete a Nuestro Club de Ofertas</h2>
                <p class="mt-4 text-fixed-lg text-[var(--text-medium)] max-w-3xl mx-auto">Sé el primero en enterarte de nuevos productos y promociones exclusivas uniéndote a nuestro grupo de WhatsApp.</p>
            </div>
            <div class="max-w-lg mx-auto bg-white p-8 rounded-xl shadow-lg text-center fade-in-up" style="transition-delay: 150ms;">
                <div class="space-y-4">
                    <p class="text-fixed-lg"><strong>Canal de anuncios:</strong> Solo administradores</p>
                    <p class="text-fixed-lg"><strong>Cero spam,</strong> solo información útil.</p>
                </div>
                <a href="#" id="contactWhatsappBtn" class="mt-8 inline-block bg-green-500 text-white font-bold py-3 px-8 rounded-full text-fixed-lg hover:bg-green-600 transform hover:scale-105 transition-all duration-300 shadow-lg">Unirse al Grupo de WhatsApp</a>
            </div>
         </div>
    </section>
</main>

<footer class="bg-[var(--text-dark)] text-white py-8">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center text-gray-400">
        <div class="flex justify-center items-center gap-6 mb-6">
            <a href="https://wa.me/5356382909?text=¡Hola!%20Me%20interesa%20hacer%20un%20pedido." target="_blank" class="text-gray-400 hover:text-white transition-transform hover:scale-110"><svg class="h-8 w-8" viewBox="0 0 24 24" fill="currentColor"><path d="M12.04 2C7.38 2 3.51 5.87 3.51 10.53C3.51 12.02 3.9 13.43 4.6 14.65L3.32 20.02L8.76 18.73C9.9 19.37 11.19 19.72 12.51 19.72H12.53C17.19 19.72 21.06 15.85 21.06 11.19C21.06 6.53 17.19 2.66 12.53 2.66H12.51Z"/></svg></a>
        </div>
        <p class="text-fixed-sm">&copy; 2024 El Resolvito. Todos los derechos reservados.</p>
    </div>
</footer>
    
<!-- Modals (Carrito, Detalles de Producto, Checkout) -->
<div id="cartModal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
    <div class="modal-content bg-white rounded-xl shadow-2xl max-w-md w-full max-h-[90vh] flex flex-col">
        <div class="p-6 border-b"><div class="flex justify-between items-center"><h3 class="text-fixed-xl font-bold text-[var(--text-dark)]">Tu Carrito</h3><button id="closeCartModal" class="text-gray-500 hover:text-gray-700"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button></div></div>
        <div id="cartItems" class="p-6 overflow-y-auto"><p class="text-center text-[var(--text-medium)] text-fixed-base">Tu carrito está vacío</p></div>
        <div class="p-6 border-t"><div class="flex justify-between items-center mb-4"><span class="text-fixed-lg font-bold">Total:</span><span id="cartTotal" class="text-fixed-lg font-bold text-[var(--primary-color)]">$0</span></div><button id="sendWhatsAppOrder" class="w-full bg-green-500 text-white font-bold py-3 px-6 rounded-lg text-fixed-base hover:bg-green-600 transition-colors duration-300 disabled:opacity-50 disabled:cursor-not-allowed" disabled>Enviar Pedido por WhatsApp</button></div>
    </div>
</div>
<div id="productDetailsModal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[1000]">
    <div class="modal-content bg-white rounded-lg shadow-xl w-11/12 max-w-md max-h-[90vh] flex flex-col">
        <div class="flex justify-between items-center p-4 border-b"><h2 id="productDetailsTitle" class="text-fixed-2xl font-bold"></h2><button id="closeProductDetailsModalBtn" class="text-gray-500 hover:text-gray-800 text-fixed-3xl">&times;</button></div>
        <div class="p-6 overflow-y-auto">
            <img id="productDetailsImage" src="" alt="Imagen del Producto" class="w-full h-64 object-contain rounded-lg mb-4">
            <p id="productDetailsDescription" class="text-fixed-base text-[var(--text-medium)] mb-4"></p>
            <div id="unitTypeSection" class="mb-4 hidden">
                <label class="block text-fixed-base font-semibold text-gray-700 mb-2">Tipo de compra:</label>
                <div class="flex gap-2">
                    <button id="unitTypeIndividual" class="unit-type-btn flex-1 py-2 px-4 border border-gray-300 rounded-lg text-fixed-sm font-medium transition-colors active">Individual</button>
                    <button id="unitTypeBox" class="unit-type-btn flex-1 py-2 px-4 border border-gray-300 rounded-lg text-fixed-sm font-medium transition-colors">Por Caja (24 unidades)</button>
                </div>
            </div>
            <p id="productDetailsPrice" class="text-fixed-3xl font-bold text-[var(--primary-color)] mb-6 text-center"></p>
            <div class="flex items-center justify-center space-x-4 mb-4">
                <button id="decreaseQuantityBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold w-10 h-10 rounded-full text-fixed-xl">-</button>
                <span id="productQuantityDisplay" class="text-fixed-2xl font-bold w-12 text-center">1</span>
                <button id="increaseQuantityBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold w-10 h-10 rounded-full text-fixed-xl">+</button>
            </div>
            <div class="bg-gray-50 p-4 rounded-lg mb-4"><div class="flex justify-between items-center"><span class="text-fixed-lg font-semibold">Total:</span><span id="modalTotalPrice" class="text-fixed-2xl font-bold text-[var(--accent-color)]">$0</span></div></div>
            <button id="addProductToCartModalBtn" class="w-full bg-[var(--accent-color)] text-white font-bold py-3 px-6 rounded-lg hover:bg-opacity-90 transition-all duration-300 text-fixed-lg">Añadir al Carrito</button>
        </div>
    </div>
</div>
<div id="checkoutModal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4">
    <div class="modal-content bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] flex flex-col overflow-hidden">
        <div class="p-6 border-b"><div class="flex justify-between items-center"><h3 class="text-fixed-2xl font-bold text-[var(--text-dark)]">Finalizar Pedido</h3><button id="closeCheckoutModal" class="text-gray-500 hover:text-gray-700"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button></div></div>
        <div class="flex-1 overflow-y-auto">
            <div class="p-6 border-b">
                <h4 class="text-fixed-lg font-bold text-[var(--text-dark)] mb-4">1. Resumen de tu Pedido</h4>
                <div id="checkoutOrderSummary" class="space-y-3 mb-4"></div>
                <div id="upsellMessage" class="my-4 p-3 rounded-lg text-center font-semibold text-sm transition-all duration-300"></div>
                <div class="bg-gray-50 p-4 rounded-lg space-y-2"><div class="flex justify-between text-fixed-base"><span>Subtotal de productos:</span><span id="checkoutSubtotal" class="font-semibold">$0</span></div><div class="flex justify-between text-fixed-base text-gray-600"><span>Servicio y Empaque:</span><span id="checkoutServiceFee" class="font-semibold">$50</span></div><div class="flex justify-between text-fixed-base"><span>Costo de envío:</span><span id="checkoutShipping" class="font-semibold">$0</span></div><div id="shippingNote" class="text-fixed-sm text-gray-600 hidden"></div><hr class="my-2"><div class="flex justify-between text-fixed-lg font-bold text-[var(--primary-color)]"><span>Total a Pagar:</span><span id="checkoutTotal">$0</span></div></div>
            </div>
            <div class="p-6 border-b"><h4 class="text-fixed-lg font-bold text-[var(--text-dark)] mb-4">2. Datos de Contacto</h4><div class="space-y-4"><div><label for="customerName" class="block text-fixed-base font-semibold text-gray-700 mb-2">Nombre completo *</label><input type="text" id="customerName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[var(--primary-color)] focus:border-transparent transition text-fixed-base" required></div><div><label for="customerAddress" class="block text-fixed-base font-semibold text-gray-700 mb-2">Calle y número (ej: Aguiar #230 apto 1) *</label><input type="text" id="customerAddress" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[var(--primary-color)] focus:border-transparent transition text-fixed-base" required></div><div><label for="customerReferences" class="block text-fixed-base font-semibold text-gray-700 mb-2">Puntos de Referencia (ej: Frente a la bodega)</label><input type="text" id="customerReferences" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[var(--primary-color)] focus:border-transparent transition text-fixed-base"></div><div><label for="customerPhone" class="block text-fixed-base font-semibold text-gray-700 mb-2">Número de teléfono *</label><input type="tel" id="customerPhone" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[var(--primary-color)] focus:border-transparent transition text-fixed-base" required></div><div><label for="deliveryLocation" class="block text-fixed-base font-semibold text-gray-700 mb-2">Ubicación *</label><select id="deliveryLocation" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[var(--primary-color)] focus:border-transparent transition text-fixed-base" required><option value="">Selecciona tu ubicación</option><option value="habana-vieja">Habana Vieja</option><option value="otros">Otros municipios</option></select></div></div></div>
            <div class="p-6 border-b"><h4 class="text-fixed-lg font-bold text-[var(--text-dark)] mb-4">3. Detalles del Pago</h4><div class="space-y-4"><div><label class="block text-fixed-base font-semibold text-gray-700 mb-2">Método de pago *</label><div class="space-y-2"><label class="flex items-center"><input type="radio" name="paymentMethod" value="efectivo" class="mr-3 text-[var(--primary-color)] focus:ring-[var(--primary-color)]"><span class="text-fixed-base">Efectivo</span></label><label class="flex items-center"><input type="radio" name="paymentMethod" value="transferencia" class="mr-3 text-[var(--primary-color)] focus:ring-[var(--primary-color)]"><span class="text-fixed-base">Transferencia</span></label></div></div><div id="cashPaymentField" class="hidden"><label class="block text-fixed-base font-semibold text-gray-700 mb-2">Pagaré con...</label><div class="flex flex-wrap gap-2"><button type="button" class="cash-btn" data-amount="20">$20</button><button type="button" class="cash-btn" data-amount="50">$50</button><button type="button" class="cash-btn" data-amount="100">$100</button><button type="button" class="cash-btn" data-amount="200">$200</button><button type="button" class="cash-btn" data-amount="500">$500</button><button type="button" class="cash-btn" data-amount="1000">$1000</button><button type="button" class="cash-btn" data-amount="otro">Otro</button></div><input type="text" id="otherCashAmount" placeholder="Especifica otro monto" class="hidden w-full mt-2 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[var(--primary-color)] transition text-fixed-base"></div></div></div>
            <div class="p-6"><h4 class="text-fixed-lg font-bold text-[var(--text-dark)] mb-4">4. Política de Envíos</h4><div class="bg-blue-50 p-4 rounded-lg text-fixed-sm text-gray-700 space-y-2"><p><strong>Horarios de entrega:</strong> 9:00 a.m. a 8:00 p.m.</p><p><strong>Habana Vieja:</strong></p><ul class="list-disc list-inside ml-4 space-y-1"><li>Tarifa de envío: <strong>$150 CUP</strong>.</li><li class="font-semibold text-green-600">¡Envío GRATIS en compras de $1,500 CUP o más!</li></ul><p><strong>Otros municipios:</strong></p><ul class="list-disc list-inside ml-4 space-y-1"><li>El costo de envío se ajustará al precio de la agencia de mensajería externa</li><li>Se lo confirmaremos por WhatsApp antes de procesar su pedido</li></ul><p class="text-xs text-gray-600 mt-3">Al confirmar su pedido, acepta nuestras condiciones de envío y horarios establecidos.</p></div></div>
        </div>
        <div class="p-6 border-t bg-gray-50"><button id="confirmOrderBtn" class="w-full bg-green-500 text-white font-bold py-4 px-4 rounded-lg text-fixed-base hover:bg-green-600 transition-colors duration-300 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl transform hover:scale-[1.02] active:scale-[0.98]">Confirmar y Enviar Pedido</button></div>
    </div>
</div>

<button id="floatingCartBtn" class="fixed bottom-6 right-6 bg-[var(--primary-color)] text-white px-5 py-3 rounded-full shadow-lg hover:bg-opacity-90 transition-all duration-300 transform hover:scale-105 z-40 flex items-center gap-3">
    <div class="relative">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
            <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .49.598l-1 5a.5.5 0 0 1-.465.402H3.62a.5.5 0 0 1-.49-.598l-1-5A.5.5 0 0 1 2 1H.5a.5.5 0 0 1-.5-.5zM3.14 5l.5 2.5h7.45l.5-2.5H3.14zM5 12a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0zm9-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0z"/>
        </svg>
        <span id="cartCount" class="absolute -top-1 -right-1 bg-[var(--accent-color)] text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold">0</span>
    </div>
    <span id="floatingCartTotal" class="text-fixed-lg font-bold">$0</span>
</button>

<script>
    var products = [
        { id: 1, name: "Aceite", price: 900, image: "https://i.postimg.cc/FFdbnBBS/aceite.jpg", description: "Botella de aceite vegetal.", category: "Mercado", status: "available", hasBoxOption: false },
        { id: 2, name: "Arroz", price: 650, image: "https://i.postimg.cc/ZRR352mX/arroz.jpg", description: "Precio de oferta. Paquete de 1 kg aprox.", category: "Mercado", status: "available", hasBoxOption: false },
        { id: 3, name: "Spaghetti", price: 350, image: "https://i.postimg.cc/rpBWC2DW/spaguetis.png", description: "Paquete de spaghetti de 400g.", category: "Mercado", status: "available", hasBoxOption: false },
        { id: 4, name: "Picadillo", price: 380, image: "https://i.postimg.cc/pdhzFLLR/picadillo-de-pollo.png", description: "Paquete de picadillo de ave.", category: "Cárnicos", status: "available", hasBoxOption: false },
        { id: 5, name: "Salchichas (Perritos)", price: 400, image: "https://i.postimg.cc/R0mKFv73/salchichas-1-paquete.png", description: "Paquete de salchichas tipo perrito.", category: "Cárnicos", status: "available", hasBoxOption: false },
        { id: 6, name: "Cerveza Presidente", price: 220, image: "https://i.postimg.cc/sXBWqMwz/cerveza-predidente-precio-220.png", description: "Lata de 355 ml.", category: "Líquidos", status: "available", hasBoxOption: true, boxPrice: 5280, boxQuantity: 24 },
        { id: 7, name: "Malta Guajira", price: 250, image: "https://i.postimg.cc/mD0wD6fZ/malta-guajira.jpg", description: "Lata de malta refrescante.", category: "Líquidos", status: "available", hasBoxOption: false },
        { id: 8, name: "Leche Condensada", price: 520, image: "https://i.postimg.cc/fRbxMK43/leche-condensada.jpg", description: "Lata de leche condensada.", category: "Mercado", status: "available", hasBoxOption: false },
        { id: 9, name: "Jabón de Baño", price: 160, image: "https://i.postimg.cc/G2L6d16q/Jab-n-Ridel-100g.png", description: "Pastilla de jabón de baño.", category: "Aseo Personal", status: "available", hasBoxOption: false },
        { id: 10, name: "Refresco Instantáneo", price: 40, image: "https://i.postimg.cc/MTzsbBM1/refresco-1.png", description: "Sobre de refresco en polvo. Varios sabores.", category: "Líquidos", status: "available", hasBoxOption: false },
        { id: 11, name: "Hígado de Pollo", price: 850, image: "https://i.postimg.cc/52k8yC1s/hiogado_de_pollo.jpg", description: "Paquete de 1 kg.", category: "Cárnicos", status: "available", hasBoxOption: false },
        { id: 12, name: "Whisky Jolly", price: 400, image: "https://i.postimg.cc/8zBPM9Yn/grok_image_xotf0za.jpg", description: "Botella de 200 ml.", category: "Líquidos", status: "available", hasBoxOption: false },
        { id: 13, name: "Frijol Negro", price: 680, image: "https://i.postimg.cc/rFt14B4k/frijol_negro.jpg", description: "Paquete de 1 kg.", category: "Mercado", status: "available", hasBoxOption: false },
        { id: 14, name: "Galletas SaltiBloks", price: 890, image: "https://i.postimg.cc/c4qpfNz7/Galletas-7-tacos.png", description: "1 paquete de galletas.", category: "Confituras", status: "available", hasBoxOption: false },
        { id: 15, name: "Detergente Brillante", price: 350, image: "https://i.postimg.cc/NfD6hnnq/detergente_brillante.jpg", description: "Bolsa de detergente en polvo.", category: "Aseo Personal", status: "available", hasBoxOption: false },
        { id: 16, name: "Cerveza Unlaguer", price: 250, image: "https://i.postimg.cc/HLv56w03/cerveza-ulaguer-precio-300.png", description: "Lata de cerveza Unlaguer.", category: "Líquidos", status: "available", hasBoxOption: true, boxPrice: 6000, boxQuantity: 24 },
        { id: 17, name: "Cerveza Cristal", price: 280, image: "https://i.postimg.cc/MZ5gbYw8/cristal.png", description: "Lata de cerveza Cristal.", category: "Líquidos", status: "available", hasBoxOption: true, boxPrice: 6720, boxQuantity: 24 },
        { id: 18, name: "Azúcar Blanca", price: 600, image: "https://i.postimg.cc/c40RbWXB/azucar_blanca.jpg", description: "Paquete de 1 kg.", category: "Mercado", status: "available", hasBoxOption: false },
        { id: 19, name: "Papel Sanitario", price: 530, image: "https://i.postimg.cc/Znt5rmJ2/grok_image_xypezad.jpg", description: "Paquete de 4 rollos.", category: "Aseo Personal", status: "available", hasBoxOption: false },
        { id: 20, name: "Malta Morena", price: 210, image: "https://i.postimg.cc/pLsccNs6/Malta-Morena-8-oz-Lata.jpg", description: "Lata de 8 oz.", category: "Líquidos", status: "available", hasBoxOption: false }
    ];
    
    products.sort((a, b) => {
        if (a.category < b.category) return -1;
        if (a.category > b.category) return 1;
        if (a.name < b.name) return -1;
        if (a.name > b.name) return 1;
        return 0;
    });
    
    var cart = JSON.parse(localStorage.getItem('cart')) || [];
    var whatsappGroupLink = 'https://chat.whatsapp.com/H19dIofkINdHrVApA4jbvW?mode=ac_t';
    var currentProductForModal = null;
    var currentUnitType = 'individual';
    var selectedCashAmount = '';

    document.addEventListener('DOMContentLoaded', function() {
        setupStoreSection('mercado', products);
        updateCartUI();
        setupGeneralEventListeners();
        setupScrollAnimations();
        setupScrollHeader();
        setupHeroSlider();
    });

    function setupHeroSlider() {
        const slides = document.querySelectorAll('#heroSlider .hero-slide');
        if (slides.length <= 1) return;

        const prevBtn = document.getElementById('prevSlideBtn');
        const nextBtn = document.getElementById('nextSlideBtn');
        let currentSlide = 0;
        let slideInterval;
        let isTransitioning = false;

        function showSlide(nextIndex) {
            if (isTransitioning || nextIndex === currentSlide) return;
            isTransitioning = true;

            const currentSlideEl = slides[currentSlide];
            const nextSlideEl = slides[nextIndex];

            nextSlideEl.style.zIndex = 2;
            nextSlideEl.classList.add('active');

            setTimeout(() => {
                currentSlideEl.classList.remove('active');
                currentSlideEl.style.zIndex = 1;
                nextSlideEl.style.zIndex = 1;
                
                currentSlide = nextIndex;
                isTransitioning = false;
            }, 1000); 
        }

        function nextSlide() {
            const nextIndex = (currentSlide + 1) % slides.length;
            showSlide(nextIndex);
        }

        function prevSlide() {
            const nextIndex = (currentSlide - 1 + slides.length) % slides.length;
            showSlide(nextIndex);
        }
        
        function startSlider() {
            slideInterval = setInterval(nextSlide, 3000);
        }

        function resetSliderInterval() {
            clearInterval(slideInterval);
            startSlider();
        }
        
        slides.forEach(slide => slide.style.zIndex = 1);
        slides[currentSlide].classList.add('active');

        prevBtn.addEventListener('click', () => {
            prevSlide();
            resetSliderInterval();
        });
        
        nextBtn.addEventListener('click', () => {
            nextSlide();
            resetSliderInterval();
        });

        startSlider();
    }


    function setupStoreSection(sectionPrefix, productsForSection) {
        var filtersId = sectionPrefix + 'CategoryFilters';
        var searchId = sectionPrefix + 'SearchInput';
        var gridId = sectionPrefix + 'ProductGrid';
        var noResultsId = sectionPrefix + 'NoResultsMessage';
        setupCategoryFiltersAndSearch(productsForSection, filtersId, searchId, gridId, noResultsId);
        renderProducts(productsForSection, gridId, noResultsId);
    }
    
    function setupCategoryFiltersAndSearch(productsForSection, filtersId, searchId, gridId, noResultsId) {
        var uniqueCategories = ['all', ...new Set(productsForSection.map(p => p.category))];
        var filtersContainer = document.getElementById(filtersId);
        if (!filtersContainer) return;

        filtersContainer.innerHTML = uniqueCategories.map(category => 
            `<button class="category-btn ${category === 'all' ? 'active' : ''}" data-category="${category}">${category === 'all' ? 'Todos' : category}</button>`
        ).join('');

        var currentCategory = 'all';
        var categoryButtons = filtersContainer.querySelectorAll('.category-btn');
        var searchInput = document.getElementById(searchId);

        function filterAndRender() {
            var searchTerm = searchInput.value.toLowerCase();
            var filteredProducts = productsForSection.filter(product => {
                var categoryMatch = (currentCategory === 'all' || product.category === currentCategory);
                var searchMatch = (!searchTerm || product.name.toLowerCase().includes(searchTerm) || product.description.toLowerCase().includes(searchTerm));
                return categoryMatch && searchMatch;
            });
            renderProducts(filteredProducts, gridId, noResultsId);
        }

        categoryButtons.forEach(button => {
            button.addEventListener('click', function() {
                categoryButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                currentCategory = this.dataset.category;
                filterAndRender();
            });
        });
        searchInput.addEventListener('input', filterAndRender);
    }

    function renderProducts(productsToRender, gridId, noResultsId) {
        var productGrid = document.getElementById(gridId);
        var noResultsMessage = document.getElementById(noResultsId);
        if (!productGrid || !noResultsMessage) return;

        noResultsMessage.classList.toggle('hidden', productsToRender.length > 0);
        productGrid.innerHTML = '';

        if (productsToRender.length === 0) return;
        
        var groupedProducts = productsToRender.reduce((acc, product) => {
            (acc[product.category] = acc[product.category] || []).push(product);
            return acc;
        }, {});

        var html = Object.keys(groupedProducts).sort().map(category => {
            const productsHtml = groupedProducts[category].map((product, index) => `
                <div class="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 cursor-pointer fade-in-up" style="transition-delay: ${index * 50}ms" onclick="showProductDetailsModal(${product.id})">
                    <div class="w-full h-56 md:h-64 overflow-hidden bg-transparent flex items-center justify-center">
                        <img src="${product.image}" alt="${product.name}" class="w-full h-full object-contain transition-all duration-300">
                    </div>
                    <div class="p-4">
                        <h3 class="text-fixed-lg font-bold text-[var(--text-dark)] mb-2">${product.name}</h3>
                        <p class="text-fixed-sm text-[var(--text-medium)] mb-2">${product.description}</p>
                        <p class="text-fixed-xl font-bold text-[var(--primary-color)] mb-4">$${product.price.toLocaleString()}</p>
                        ${product.status === 'unavailable' ? '<span class="text-red-500 text-fixed-sm font-semibold">No disponible</span>' : '<button class="w-full bg-[var(--primary-color)] text-white font-bold py-2 px-4 rounded-lg text-fixed-base hover:bg-opacity-90 transition-colors duration-300">Ver Detalles</button>'}
                    </div>
                </div>`).join('');
            
            return `<div class="col-span-full fade-in-up">
                        <h3 class="text-2xl font-bold text-center text-[var(--primary-color)] my-8 border-b-2 border-gray-200 pb-2">— ${category} —</h3>
                    </div>
                    ${productsHtml}`;
        }).join('');

        productGrid.innerHTML = `<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">${html}</div>`;
        setupScrollAnimations();
    }
    
    function showProductDetailsModal(productId){var product=products.find(p=>p.id===productId);if(!product||product.status==='unavailable')return;currentProductForModal={...product,quantity:1};currentUnitType='individual';document.getElementById('productDetailsTitle').textContent=product.name;document.getElementById('productDetailsImage').src=product.image;document.getElementById('productDetailsDescription').textContent=product.description;document.getElementById('productQuantityDisplay').textContent='1';document.getElementById('unitTypeSection').classList.toggle('hidden',!product.hasBoxOption);if(product.hasBoxOption){updateUnitTypeButtons();}
    updateModalPricing();document.getElementById('productDetailsModal').classList.add('show');}
    function updateUnitTypeButtons(){document.getElementById('unitTypeIndividual').classList.toggle('active',currentUnitType==='individual');document.getElementById('unitTypeBox').classList.toggle('active',currentUnitType==='box');}
    function updateModalPricing(){if(!currentProductForModal)return;let unitPrice,unitDescription;if(currentProductForModal.hasBoxOption&&currentUnitType==='box'){unitPrice=currentProductForModal.boxPrice;unitDescription=`Caja (${currentProductForModal.boxQuantity}u)`;}else{unitPrice=currentProductForModal.price;unitDescription='Unidad';}
    let totalPrice=unitPrice*currentProductForModal.quantity;document.getElementById('productDetailsPrice').textContent=`$${unitPrice.toLocaleString()} / ${unitDescription}`;document.getElementById('modalTotalPrice').textContent=`$${totalPrice.toLocaleString()}`;}
    function addToCartFromModal(){if(!currentProductForModal)return;let cartItem={id:currentProductForModal.id+(currentUnitType==='box'?'_box':''),name:currentProductForModal.name,image:currentProductForModal.image,quantity:currentProductForModal.quantity,unitType:currentUnitType};if(currentProductForModal.hasBoxOption&&currentUnitType==='box'){cartItem.price=currentProductForModal.boxPrice;cartItem.name+=` (Caja x${currentProductForModal.boxQuantity})`;}else{cartItem.price=currentProductForModal.price;}
    let existingItem=cart.find(item=>item.id===cartItem.id);if(existingItem){existingItem.quantity+=cartItem.quantity;}else{cart.push(cartItem);}
    updateCartUI();localStorage.setItem('cart',JSON.stringify(cart));document.getElementById('productDetailsModal').classList.remove('show');currentProductForModal=null;showCartAnimation();}
    
    function updateCartUI(){
        var totalItems=cart.reduce((sum,item)=>sum+item.quantity,0);
        var totalPrice=cart.reduce((sum,item)=>sum+(item.price*item.quantity),0);
        document.getElementById('cartCount').textContent=totalItems;
        document.getElementById('cartTotal').textContent=`$${totalPrice.toLocaleString()}`;
        document.getElementById('floatingCartTotal').textContent=`$${totalPrice.toLocaleString()}`;
        var cartItems=document.getElementById('cartItems');
        var sendWhatsAppOrder=document.getElementById('sendWhatsAppOrder');
        sendWhatsAppOrder.disabled=cart.length===0;
        if(cart.length===0){
            cartItems.innerHTML='<p class="text-center text-[var(--text-medium)] text-fixed-base">Tu carrito está vacío</p>';
        }else{
            cartItems.innerHTML=cart.map((item,index)=>`
            <div class="flex items-center justify-between py-3 border-b border-gray-100 last:border-b-0">
                <div class="flex-1">
                    <h4 class="text-fixed-base font-semibold text-[var(--text-dark)]">${item.name}</h4>
                    <p class="text-fixed-sm text-[var(--text-medium)]">$${item.price.toLocaleString()} c/u</p>
                </div>
                <div class="flex items-center gap-2">
                    <button onclick="updateCartQuantity(${index},${item.quantity-1})" class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-fixed-sm font-bold hover:bg-gray-300 transition-colors">-</button>
                    <span class="text-fixed-base font-semibold w-8 text-center">${item.quantity}</span>
                    <button onclick="updateCartQuantity(${index},${item.quantity+1})" class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-fixed-sm font-bold hover:bg-gray-300 transition-colors">+</button>
                    <button onclick="removeFromCart(${index})" class="ml-2 text-red-500 hover:text-red-700 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg></button>
                </div>
            </div>`).join('');
        }
    }

    function updateCartQuantity(index,newQuantity){if(newQuantity<=0){removeFromCart(index);}else{cart[index].quantity=newQuantity;}updateCartUI();localStorage.setItem('cart',JSON.stringify(cart));}
    function removeFromCart(index){cart.splice(index,1);updateCartUI();localStorage.setItem('cart',JSON.stringify(cart));}
    function showCartAnimation(){var floatingCartBtn=document.getElementById('floatingCartBtn');floatingCartBtn.classList.add('shake');setTimeout(()=>floatingCartBtn.classList.remove('shake'),600);}
    function setupGeneralEventListeners(){document.getElementById('floatingCartBtn').addEventListener('click',()=>document.getElementById('cartModal').classList.add('show'));document.getElementById('closeCartModal').addEventListener('click',()=>document.getElementById('cartModal').classList.remove('show'));document.getElementById('cartModal').addEventListener('click',e=>{if(e.target.id==='cartModal')document.getElementById('cartModal').classList.remove('show');});document.getElementById('closeProductDetailsModalBtn').addEventListener('click',()=>{document.getElementById('productDetailsModal').classList.remove('show');currentProductForModal=null;});document.getElementById('productDetailsModal').addEventListener('click',e=>{if(e.target.id==='productDetailsModal'){document.getElementById('productDetailsModal').classList.remove('show');currentProductForModal=null;}});document.getElementById('unitTypeIndividual').addEventListener('click',()=>{currentUnitType='individual';updateUnitTypeButtons();updateModalPricing();});document.getElementById('unitTypeBox').addEventListener('click',()=>{currentUnitType='box';updateUnitTypeButtons();updateModalPricing();});document.getElementById('decreaseQuantityBtn').addEventListener('click',()=>{if(currentProductForModal&&currentProductForModal.quantity>1){currentProductForModal.quantity--;document.getElementById('productQuantityDisplay').textContent=currentProductForModal.quantity;updateModalPricing();}});document.getElementById('increaseQuantityBtn').addEventListener('click',()=>{if(currentProductForModal){currentProductForModal.quantity++;document.getElementById('productQuantityDisplay').textContent=currentProductForModal.quantity;updateModalPricing();}});document.getElementById('addProductToCartModalBtn').addEventListener('click',addToCartFromModal);document.getElementById('sendWhatsAppOrder').addEventListener('click',()=>{document.getElementById('cartModal').classList.remove('show');showCheckoutModal();});document.getElementById('contactWhatsappBtn').addEventListener('click',e=>{e.preventDefault();window.open(whatsappGroupLink,'_blank');});document.getElementById('mobile-menu-button').addEventListener('click',()=>{document.getElementById('mobile-menu').classList.add('open');document.getElementById('mobile-backdrop').classList.add('open');});document.getElementById('close-mobile-menu').addEventListener('click',closeMobileMenu);document.getElementById('mobile-backdrop').addEventListener('click',closeMobileMenu);
    document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener('click',function(e){e.preventDefault();const targetId=this.getAttribute('href');const targetElement=document.querySelector(targetId);if(targetElement){if(this.classList.contains('mobile-nav-link')){closeMobileMenu();}
    setTimeout(()=>{const headerOffset=80;const elementPosition=targetElement.getBoundingClientRect().top;const offsetPosition=elementPosition+window.pageYOffset-headerOffset;window.scrollTo({top:offsetPosition});},100);}});});
    setupCheckoutEventListeners();}
    function closeMobileMenu(){document.getElementById('mobile-menu').classList.remove('open');document.getElementById('mobile-backdrop').classList.remove('open');}
    function setupScrollAnimations(){if('IntersectionObserver' in window){const observer=new IntersectionObserver(entries=>{entries.forEach(entry=>{if(entry.isIntersecting){entry.target.classList.add('is-visible');}});},{threshold:0.1});document.querySelectorAll('.fade-in-up, .fade-in-left, .fade-in-right').forEach(el=>observer.observe(el));}else{document.querySelectorAll('.fade-in-up, .fade-in-left, .fade-in-right').forEach(el=>el.classList.add('is-visible'));}}
    function setupScrollHeader(){const header=document.getElementById('mainHeader');window.addEventListener('scroll',()=>{header.classList.toggle('scrolled',window.scrollY>100);});}
    function showCheckoutModal(){if(cart.length===0){alert('Tu carrito está vacío');return;}
    const savedData=JSON.parse(localStorage.getItem('customerData'));if(savedData){document.getElementById('customerName').value=savedData.name||'';document.getElementById('customerAddress').value=savedData.address||'';document.getElementById('customerReferences').value=savedData.references||'';document.getElementById('customerPhone').value=savedData.phone||'';document.getElementById('deliveryLocation').value='habana-vieja';}
    updateCheckoutSummary();document.getElementById('checkoutModal').classList.add('show');}
    
    function updateCheckoutSummary(){
        const checkoutOrderSummary=document.getElementById('checkoutOrderSummary');
        const subtotal=cart.reduce((sum,item)=>sum+(item.price*item.quantity),0);
        checkoutOrderSummary.innerHTML=cart.map(item=>`
            <div class="flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0">
                <div class="flex-1">
                    <h5 class="text-fixed-base font-semibold text-[var(--text-dark)]">${item.name}</h5>
                    <p class="text-fixed-sm text-[var(--text-medium)]">$${item.price.toLocaleString()} c/u × ${item.quantity}</p>
                </div>
                <div class="text-fixed-base font-semibold">$${(item.price*item.quantity).toLocaleString()}</div>
            </div>`).join('');
        document.getElementById('checkoutSubtotal').textContent=`$${subtotal.toLocaleString()}`;
        updateShippingAndTotal();
    }

    function updateShippingAndTotal() {
        const subtotal=cart.reduce((sum, item)=>sum+(item.price*item.quantity),0);
        const serviceFee=50;
        document.getElementById('checkoutServiceFee').textContent=`$${serviceFee}`;
        const deliveryLocation=document.getElementById('deliveryLocation').value;
        let shippingCost=0;
        let shippingText='$0';
        let showNote=false;
        let noteText='';
        let upsellMessage='';
        const upsellElement=document.getElementById('upsellMessage');

        if(deliveryLocation==='habana-vieja'){
            if(subtotal>=3500){shippingCost=0;shippingText='GRATIS (Pedido > $3,500)';upsellMessage='¡Felicidades! Tienes Envío GRATIS.';upsellElement.className='my-4 p-3 rounded-lg text-center font-semibold text-sm bg-green-100 text-green-800';}
            else if(subtotal>=1500){shippingCost=50;shippingText='Descuento: $50 CUP';const neededForFree=3500-subtotal;upsellMessage=`¡A solo $${neededForFree.toLocaleString()} del Envío GRATIS!`;upsellElement.className='my-4 p-3 rounded-lg text-center font-semibold text-sm bg-blue-100 text-blue-800';}
            else{shippingCost=150;shippingText='$150 CUP';const neededForDiscount=1500-subtotal;upsellMessage=`¡Añade $${neededForDiscount.toLocaleString()} y paga solo $50 de envío!`;upsellElement.className='my-4 p-3 rounded-lg text-center font-semibold text-sm bg-yellow-100 text-yellow-800';}
        }else if(deliveryLocation==='otros'){shippingCost=0;shippingText='A confirmar';showNote=true;noteText='El costo se ajustará al precio de la mensajería. Te confirmaremos por WhatsApp.';upsellMessage='';}
        else{upsellMessage='';}

        upsellElement.textContent=upsellMessage;
        upsellElement.style.display=upsellMessage?'block':'none';
        
        document.getElementById('checkoutShipping').textContent=shippingText;
        const shippingNote=document.getElementById('shippingNote');
        shippingNote.textContent=noteText;
        shippingNote.classList.toggle('hidden',!showNote);
        const total=subtotal+serviceFee+shippingCost;
        document.getElementById('checkoutTotal').textContent=`$${total.toLocaleString()}`;
    }

    function setupCheckoutEventListeners(){document.getElementById('closeCheckoutModal').addEventListener('click',()=>document.getElementById('checkoutModal').classList.remove('show'));document.getElementById('checkoutModal').addEventListener('click',e=>{if(e.target.id==='checkoutModal')document.getElementById('checkoutModal').classList.remove('show');});document.getElementById('deliveryLocation').addEventListener('change',updateShippingAndTotal);
    document.querySelectorAll('input[name="paymentMethod"]').forEach(radio=>{radio.addEventListener('change',function(){document.getElementById('cashPaymentField').classList.toggle('hidden',this.value!=='efectivo');if(this.value!=='efectivo'){selectedCashAmount='';document.querySelectorAll('.cash-btn').forEach(b=>b.classList.remove('active'));document.getElementById('otherCashAmount').classList.add('hidden');}});});
    document.querySelectorAll('.cash-btn').forEach(button=>{button.addEventListener('click',function(){document.querySelectorAll('.cash-btn').forEach(b=>b.classList.remove('active'));this.classList.add('active');selectedCashAmount=this.dataset.amount;const otherInput=document.getElementById('otherCashAmount');otherInput.classList.toggle('hidden',selectedCashAmount!=='otro');if(selectedCashAmount==='otro'){otherInput.focus();}});});
    document.getElementById('confirmOrderBtn').addEventListener('click',confirmOrder);}
    function validateCheckoutForm(){const requiredFields=[{id:'customerName',name:'Nombre'},{id:'customerAddress',name:'Dirección'},{id:'customerPhone',name:'Teléfono'},{id:'deliveryLocation',name:'Ubicación'}];let errors=[];requiredFields.forEach(field=>{const element=document.getElementById(field.id);if(!element.value.trim()){errors.push(field.name);element.classList.add('border-red-500');}else{element.classList.remove('border-red-500');}});
    if(!document.querySelector('input[name="paymentMethod"]:checked')){errors.push('Método de pago');}
    if(errors.length>0){alert('Por favor completa los campos:\n• '+errors.join('\n• '));return false;}
    return true;}
    
    function confirmOrder(){if(!validateCheckoutForm())return;
        const customerName=document.getElementById('customerName').value.trim();
        const customerAddress=document.getElementById('customerAddress').value.trim();
        const customerReferences=document.getElementById('customerReferences').value.trim();
        const customerPhone=document.getElementById('customerPhone').value.trim();
        const deliveryLocation=document.getElementById('deliveryLocation').value;
        const paymentMethod=document.querySelector('input[name="paymentMethod"]:checked').value;
        const cashAmount=selectedCashAmount==='otro'?document.getElementById('otherCashAmount').value.trim():selectedCashAmount;
        const subtotal=cart.reduce((sum,item)=>sum+(item.price*item.quantity),0);
        const serviceFee=50;let shippingCost=0;let shippingText='$0';
        if(deliveryLocation==='habana-vieja'){if(subtotal>=3500){shippingCost=0;shippingText='GRATIS (Pedido > $3,500)';}else if(subtotal>=1500){shippingCost=50;shippingText='Descuento: $50 CUP';}else{shippingCost=150;shippingText='$150 CUP';}}else{shippingText='A confirmar por mensajería';}
        const total=subtotal+serviceFee+shippingCost;
        const orderItems=cart.map(item=>`• ${item.name} x${item.quantity} - $${(item.price*item.quantity).toLocaleString()}`).join('\n');
        const locationText=deliveryLocation==='habana-vieja'?'Habana Vieja':'Otros municipios';
        const paymentText=paymentMethod==='efectivo'?`Efectivo${cashAmount?' (pagaré con '+cashAmount+')':''}`:'Transferencia';
        const finalMessage=`*🛒 NUEVO PEDIDO - EL RESOLVITO*\n\n*👤 DATOS DEL CLIENTE:*\n• Nombre: ${customerName}\n• Teléfono: ${customerPhone}\n• Dirección: ${customerAddress}\n• Referencias: ${customerReferences||'No especificadas'}\n• Ubicación: ${locationText}\n\n*📦 PRODUCTOS:*\n${orderItems}\n\n*💰 RESUMEN DE PAGO:*\n• Subtotal: $${subtotal.toLocaleString()}\n• Servicio/Empaque: $${serviceFee}\n• Envío: ${shippingText}\n• TOTAL A PAGAR: $${total.toLocaleString()}\n\n*💳 MÉTODO DE PAGO:*\n${paymentText}\n\n*⏰ Horario de entrega:* Se coordinará para la próxima ronda de entrega.\n\n_¡Gracias por su pedido!_ 🙏`;
        
        const whatsappPhoneNumber='56382909';
        const whatsappMessage=encodeURIComponent(finalMessage.replace(/\*/g,'').replace(/_/g,''));
        window.open(`https://wa.me/${whatsappPhoneNumber}?text=${whatsappMessage}`,'_blank');
        document.getElementById('checkoutModal').classList.remove('show');
        cart=[];updateCartUI();
        localStorage.setItem('cart',JSON.stringify(cart));
        const customerData={name:customerName,address:customerAddress,references:customerReferences,phone:customerPhone};
        localStorage.setItem('customerData',JSON.stringify(customerData));
        alert('¡Pedido enviado! Serás redirigido a WhatsApp para confirmar. ¡Gracias!');
    }
</script>

</body>
</html>


